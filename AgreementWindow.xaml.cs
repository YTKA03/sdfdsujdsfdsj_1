using System;
using System.IO;
using System.Windows;
using System.Windows.Input;

namespace GMGN_Notifications
{
    public partial class AgreementWindow : Window
    {
        private const string AgreementAcceptedFile = "agreement_accepted.txt";

        public AgreementWindow()
        {
            InitializeComponent();
            WindowStartupLocation = WindowStartupLocation.CenterScreen;
            LoadAgreementText();
        }

        private void LoadAgreementText()
        {
            try
            {
                AgreementText.Text = @"КОРИСТУВАЦЬКА УГОДА

Ця Користувацька угода (надалі – «Угода») регулює використання програмного забезпечення «GMGN Notifications» (надалі – «Програма»). Використовуючи Програму, Користувач (надалі – «Ви» або «Користувач») підтверджує свою згоду з умовами цієї Угоди. Якщо Ви не погоджуєтеся з цими умовами, будь ласка, припиніть використання Програми.

1. Загальні положення
   1.1. Програма призначена для надання інформаційних сповіщень про транзакції на платформі gmgn.ai.
   1.2. Програма не є фінансовим, інвестиційним чи торговельним інструментом і не надає жодних фінансових, інвестиційних чи інших рекомендацій.
   1.3. Усі дані, надані Програмою, мають виключно інформаційний характер і не повинні розглядатися як поради чи рекомендації для здійснення фінансових операцій.

2. Відмова від фінансових рекомендацій
   2.1. Програма не надає фінансових, інвестиційних чи торговельних рекомендацій. Будь-яка інформація, отримана через Програму, не є керівництвом до дії.
   2.2. Користувач самостійно приймає рішення щодо використання інформації, отриманої через Програму, і несе повну відповідальність за наслідки таких рішень.
   2.3. Розробник не несе відповідальності за будь-які фінансові втрати, збитки чи інші наслідки, що виникли в результаті використання Програми.

3. Відповідальність Користувача
   3.1. Користувач несе повну відповідальність за свої дії, здійснені на основі інформації, отриманої через Програму.
   3.2. Користувач зобов’язується використовувати Програму відповідно до чинного законодавства України та міжнародних норм.
   3.3. Користувач погоджується, що використання Програми здійснюється на власний ризик.

4. Обмеження відповідальності Розробника
   4.1. Програма надається «як є», без будь-яких гарантій, явних чи неявних, щодо її функціональності, точності даних чи придатності для певних цілей.
   4.2. Розробник не гарантує безперебійну роботу Програми, відсутність помилок чи сумісність із обладнанням Користувача.
   4.3. Розробник не несе відповідальності за будь-які прямі, непрямі, випадкові чи інші збитки, що виникли внаслідок використання або неможливості використання Програми.

5. Збір та використання даних
   5.1. Програма може збирати певні дані, такі як Telegram ID, MAC-адреса пристрою, серийный номер BIOS та унікальний ідентифікатор пристрою (MachineGuid), для забезпечення авторизації та перевірки підписки.
   5.2. Користувач погоджується на обробку цих даних відповідно до Політики конфіденційності Розробника.
   5.3. Розробник зобов’язується не передавати персональні дані Користувача третім особам, крім випадків, передбачених законодавством.

6. Зміни до Угоди
   6.1. Розробник залишає за собою право вносити зміни до цієї Угоди в будь-який час. Оновлена версія Угоди набуває чинності з моменту її публікації.
   6.2. Продовження використання Програми після внесення змін до Угоди означає згоду Користувача з оновленими умовами.

7. Припинення використання
   7.1. Користувач може припинити використання Програми в будь-який момент, видаливши її зі свого пристрою.
   7.2. Розробник має право припинити доступ Користувача до Програми в разі порушення умов цієї Угоди.

Продовжуючи використання Програми, Ви підтверджуєте, що ознайомилися з цією Угодою, зрозуміли її умови та погоджуєтеся їх дотримуватися.

Дата останнього оновлення: 25 квітня 2025 року";
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Помилка завантаження тексту угоди: {ex.Message}");
                MessageBox.Show("Помилка завантаження угоди. Будь ласка, спробуйте ще раз.");
                Application.Current.Shutdown();
            }
        }

        private void AcceptButton_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                // Сохраняем информацию о принятии соглашения
                File.WriteAllText(Path.Combine(AppDomain.CurrentDomain.BaseDirectory, AgreementAcceptedFile), "accepted");
                System.Diagnostics.Debug.WriteLine("Угода прийнята, файл збережено.");

                // Открываем окно авторизации
                var authWindow = new AuthWindow();
                authWindow.Show();
                Close();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Помилка збереження прийняття угоди: {ex.Message}");
                MessageBox.Show("Помилка збереження угоди. Будь ласка, спробуйте ще раз.");
            }
        }

        private void DeclineButton_Click(object sender, RoutedEventArgs e)
        {
            System.Diagnostics.Debug.WriteLine("Угода відхилена. Завершення програми.");
            Application.Current.Shutdown();
        }

        protected override void OnKeyDown(KeyEventArgs e)
        {
            base.OnKeyDown(e);
            if ((Keyboard.Modifiers & (ModifierKeys.Control | ModifierKeys.Shift)) == (ModifierKeys.Control | ModifierKeys.Shift) && e.Key == Key.I)
            {
                System.Diagnostics.Debug.WriteLine("Ctrl+Shift+I виявлено. Завершення програми.");
                Application.Current.Shutdown();
            }
            else if (e.Key == Key.F12)
            {
                System.Diagnostics.Debug.WriteLine("F12 виявлено. Завершення програми.");
                Application.Current.Shutdown();
            }
        }

        public static bool IsAgreementAccepted()
        {
            return File.Exists(Path.Combine(AppDomain.CurrentDomain.BaseDirectory, AgreementAcceptedFile));
        }
    }
}